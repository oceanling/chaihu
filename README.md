# 项目维护文档：柴胡查询系统

## 📋 项目概述
**柴胡查询系统**是一个基于Streamlit框架开发的Web应用，专门用于查询和管理柴胡属植物的品种信息。系统集成了完整的品种数据库，支持多种查询方式和数据管理功能。

## 🚀 部署信息
- **部署平台**: Streamlit Cloud
- **部署邮箱**: oceanlingyutong@outlook.com
- **GitHub仓库**: 
- **访问地址**: https://chaihuchaxun.streamlit.app/

## 🛠️ 技术栈
- **前端框架**: Streamlit 1.53.1
- **后端数据库**: SQLite3
- **数据处理**: Pandas
- **编程语言**: Python 3.13
- **CSS样式**: 自定义响应式CSS

## 📁 项目结构
```
chaihu/
├── testUI.py                    # 主应用文件
├── bupleurum.db                # SQLite数据库文件
├── 柴胡品种词典.csv            # 初始数据文件
└── requirements.txt            # 依赖包列表
```

## 🔧 功能模块

### 1. 品种搜索模块
- **关键词搜索**: 支持模糊搜索和精确匹配
- **高级筛选**: 支持根据柴胡的性状特征单独筛选：
  - 根特征（如：圆柱形、红棕色）
  - 茎特征（如：细圆、有纵槽纹）
  - 叶特征（如：线形、披针形）
  - 花特征（如：伞形花序、黄色）
  - 果实特征（如：椭圆形、卵形）
  - 花果期筛选
  - 产地/生境筛选
  - 药用功效筛选

### 2. 数据管理模块
- **批量导入**: 支持CSV文件批量导入数据
- **数据导出**: 导出为CSV格式
- **数据统计**: 实时显示品种和变种数量
- **数据库维护**: 优化数据库、清理缓存

### 3. 品种管理模块
- **添加新品种**: 通过表单添加新记录
- **变种管理**: 支持添加和管理变种信息
- **详情查看**: 完整的品种信息展示

## 📊 数据结构
### 主表：bupleurum_species
- id (主键)
- name_chinese (中文名，必填)
- name_latin (拉丁学名)
- root (根特征)
- stem (茎特征)
- leaf (叶特征)
- flower_inflorescence (花/花序特征)
- fruit (果实特征)
- flowering_fruiting (花果期)
- habitat (产地/生境)
- medicinal_use (药用功效)
- notes (备注)
- created_at/updated_at (时间戳)

### 副表：varieties
- id (主键)
- species_id (外键)
- name_chinese (变种中文名)
- description (变种描述)

## ⚙️ 维护要点

### 1. 环境配置
```bash
# 依赖包安装
pip install -r requirements.txt

# 主要依赖
streamlit==1.53.1
pandas==2.3.3
sqlite3 (Python内置)
```

### 2. 数据库初始化
- 首次运行自动创建数据库表
- 包含全文搜索索引（已移除，改用LIKE查询避免兼容性问题）
- 数据库文件：`bupleurum.db`

### 3. 数据导入
- 支持UTF-8编码的CSV文件
- 必需字段：`name_chinese`
- 可选字段：其他所有字段
- 变种字段：`varieties`（多个用分号分隔）

### 4. 兼容性说明
- 移除FTS5全文搜索，改用SQL LIKE查询
- 解决Streamlit Cloud上FTS5的兼容性问题
- 优化移动端响应式设计

## 🔄 更新记录
### v2.0.0 (当前版本)
- ✅ 修复FTS5兼容性问题
- ✅ 完善高级搜索功能
- ✅ 优化移动端体验
- ✅ 修复CSV导入功能
- ✅ 改进用户界面设计

## 🐛 已知问题与解决方案
1. **问题**: FTS5在Streamlit Cloud上不兼容
   **解决方案**: 改用LIKE查询，牺牲部分性能但保证稳定性

2. **问题**: CSV文件编码问题
   **解决方案**: 自动检测编码（utf-8-sig/gbk）

3. **问题**: 移动端布局优化
   **解决方案**: 使用响应式CSS和媒体查询

## 📈 未来改进计划
- [ ] 添加图片上传功能
- [ ] 实现数据备份与恢复
- [ ] 添加用户权限管理
- [ ] 优化搜索性能（考虑替代FTS5的方案）
- [ ] 添加API接口

## 📞 联系方式
- **项目维护者**: [填写维护者姓名]
- **技术支持邮箱**: [填写技术支持邮箱]
- **问题反馈**: GitHub Issues

## ⚠️ 注意事项
1. 部署到Streamlit Cloud时，确保`requirements.txt`文件包含所有依赖
2. 数据库文件自动生成，无需手动创建
3. 建议定期导出数据备份
4. 清空数据库操作不可逆，需谨慎使用

---

**维护提示**: 每次更新代码后，Streamlit Cloud会自动重新部署。请确保在GitHub仓库中维护最新的代码版本，并通过Streamlit Cloud的部署日志监控应用状态。
